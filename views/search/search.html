<!doctype html>
<html>

<head>
    <!---   AIzaSyC-RWs2BNTpLsQSlkgysaVkDKeJDhQhufw -->
    <title>Pozz Search Listing Testing</title>
    {% include 'search-scripts.html' %}
</head>

<body>
    <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Pozz</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="#">LInk</a>
                </li>
                <li>
                    <a href="#">Link</a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="#">Action</a>
                        </li>
                        <li>
                            <a href="#">Another action</a>
                        </li>
                        <li>
                            <a href="#">Something else here</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">Separated link</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">One more separated link</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <form class="navbar-form navbar-left" role="search">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="e.g. Macbook Air" style="width:500px;">
                </div>
                <button type="submit" class="btn btn-default">Search</button>
                <button type="button" class="btn btn-primary" id="post-button">Pozz</button>
            </form>
            <p class="navbar-text navbar-right" id="successsignin">
                <a href="#" class="navbar-link" id="signinname">{% if signedin %}{{username}}{% endif %}</a>
            </p>
            {% if !signedin %}
            <button type="button" class="btn btn-default navbar-btn" id="sign-btn">Sign In/Up</button>{% endif %}
        </div>
        <!-- /.navbar-collapse -->
    </nav>
    {% include 'search-side-category.html' %}

    <div class="listing-container">
        {% for post in result %}
        <div class="listing" id="{{ post.pid }}">
            <div class="">
                <div class="product-media-container">
                    <div class="product-media">
                        <img src="images/product1.jpg" class="product-image-main" id="image-1389">
                    </div>
                    <em>About an hour ago</em>
                    <br>
                </div>

                <div class="product-info-container" id="description-1389">
                    <div class="product-info-title product-text" id="title-1389">
                        {{ post.post_title }}
                    </div>
                    <div id="price-1389" class="product-price-container price-text">Used: ${{ post.post_price }}</div>
                    <div id="available_times-1389">Available times:
                        <a>Monday</a>
                        <a>Thursday</a>
                        <a>Friday</a>
                    </div>
                    <div>Place:
                        <img src="images/mapicon2.jpeg" class="map-icon">
                        <a>Seattle, WA</a>
                    </div>

                    <div class="product-info-description" id="text-1389">The New York Times Bestseller on the continuous innovation to create radically successfull business. I've read this book 5 times and learned a lot throughout my career as a serial
                        <span class="product-text" id="overflow-placeholder-1389">...</span>
                        <span class="product-info-description-overflow" id="overflow-1389">entrepreneur. Want to sell it to those who wants to risk it to change the world.
                        </span>
                    </div>
                </div>
                <div class="product-options-container">
                </div>
            </div>
        </div>
        {% endfor %}

    </div>

    <div class="chat-bar-container">chat bar</div>
    </div>


    {% include 'search-product-modal.html' %} {% include 'search-map-modal.html' %} {% include 'search-full-view.html' %} {% include 'search-post-box.html' %}
    <!----- Start Sign in Form ------->
    <div class="tooltip" id="signinform">
        <div class="tooltip-inner">
            <h4>Please Sign in</h4>
            <br>Username:
            <input type="text" placeholder="Username" id="username" value="">
            <br>Password:
            <input type="password" placeholder="Password" id="password" value="">
            <br>
            <input type="button" value="Sign in" id="signinbutton">
            <br>A new user?
            <a href="http://localhost:3000/signupform">Sign Up</a>
        </div>
        <div class="tooltip-arrow">
        </div>
    </div>
    <!------  End Sign in Form ------>
    <script>
        var postTitle = $("#post-title");
        var postPrice = $("post-price");
        var postDesc = $("post-description");
        var postLoc = $("post-location");
        var postStep = $("post-steps");
        var postInstruction = $("post-instructions");
        var postDays = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
        var postFiles = {};
        var index = 0;
        var postForm = $('.postbox');
        var postBackButton = $('.post-back-button');
        var postNextButton = $('.post-next-button');
        var postDay = $('.postday');
        var postProgressBar = $('#post-progress');
        var postProgressPercent = $('#post-progress-percentage');
        var progressIncrement = 25;
        var progress = progressIncrement;
        var data = {};
        var div_steps = [$('#step1'), $('#step2'), $('#step3'), $('#step4')];
    
        $(document).ready(function() {
            
            var url = "http://localhost:3000/uploadimg",
        uploadButton = $('<button/>')
            .addClass('btn btn-primary')
            .prop('disabled', true)
            .text('Processing...')
            .on('click', function () {
                var $this = $(this),
                    data = $this.data();
                $this
                    .off('click')
                    .text('Abort')
                    .on('click', function () {
                        $this.remove();
                        data.abort();
                    });
                data.submit().always(function () {
                    $this.remove();
                });
            });
    $('#fileupload').fileupload({
        url: url,
        dataType: 'json',
        autoUpload: false,
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 5000000, // 5 MB
        // Enable image resizing, except for Android and Opera,
        // which actually support image resizing, but fail to
        // send Blob objects via XHR requests:
        disableImageResize: /Android(?!.*Chrome)|Opera/
            .test(window.navigator.userAgent),
        previewMaxWidth: 100,
        previewMaxHeight: 100,
        previewCrop: true
    }).on('fileuploadadd', function (e, data) {
        data.context = $('<div/>').appendTo('#files');
        $.each(data.files, function (index, file) {
            var node = $('<p/>')
                    .append($('<span/>').text(file.name));
            if (!index) {
                node
                    .append('<br>')
                    .append(uploadButton.clone(true).data(data));
            }
            node.appendTo(data.context);
        });
    }).on('fileuploadprocessalways', function (e, data) {
        var index = data.index,
            file = data.files[index],
            node = $(data.context.children()[index]);
        if (file.preview) {
            node
                .prepend('<br>')
                .prepend(file.preview);
        }
        if (file.error) {
            node
                .append('<br>')
                .append($('<span class="text-danger"/>').text(file.error));
        }
        if (index + 1 === data.files.length) {
            data.context.find('button')
                .text('Upload')
                .prop('disabled', !!data.files.error);
        }
    }).on('fileuploadprogressall', function (e, data) {
        var progress = parseInt(data.loaded / data.total * 100, 10);
        $('#progress .progress-bar').css(
            'width',
            progress + '%'
        );
    }).on('fileuploaddone', function (e, data) {
        $.each(data.result.files, function (index, file) {
            if (file.url) {
                var link = $('<a>')
                    .attr('target', '_blank')
                    .prop('href', file.url);
                $(data.context.children()[index])
                    .wrap(link);
            } else if (file.error) {
                var error = $('<span class="text-danger"/>').text(file.error);
                $(data.context.children()[index])
                    .append('<br>')
                    .append(error);
            }
        });
    }).on('fileuploadfail', function (e, data) {
        $.each(data.files, function (index, file) {
            var error = $('<span class="text-danger"/>').text('File upload failed.');
            $(data.context.children()[index])
                .append('<br>')
                .append(error);
        });
    }).prop('disabled', !$.support.fileInput)
        .parent().addClass($.support.fileInput ? undefined : 'disabled');
            
            
            /* Show only the first step */
            for(var i = 2; i < 5; i++) {
                $('#step' + i).hide();
            }
            updateProgressBar(progress);
            updateStepIndicator(index + 1);
            postForm.hide();
            
            $('#post-button').click(function() {
                postForm.slideToggle("slow");
            });
        
//            $('#fileupload').fileupload({
//                dataType:'json'
//            });
            
            
            postBackButton.hide();
            
            $('input:file').change(function(){
                var fileInput = document.getElementById('fileupload');
                
                var files = fileInput.files;
                var file;
                
                for(var i = 0; i < files.length; i++) {
                    file = files.item(i);
                    $('#post-image-list').append(file.name + "<br>");
                }
//               alert($(this).val().replace(/.*(\/|\\)/, ''));
            });
            
            /*
                Increment progress and reveals the next step in the post form
            */
            postNextButton.click(function() {
                if(progress < 100) {
                    progress += progressIncrement;
                    div_steps[index].hide();
                    index++;
                    div_steps[index].show();
                    updateProgressBar(progress);
                    updateStepIndicator(index + 1);
                }
                if((index + 1) > 1) {
                    postBackButton.show();
                }
            });
            
            /*
                Decrement progress, hides current step and reveals previous step 
                in the post form.
            */
            postBackButton.click(function(){
                if (progress > 25) {
                    progress -= progressIncrement;
                    div_steps[index].hide();
                    index--;
                    div_steps[index].show();
                    if((index + 1) == 1) {
                        $(this).hide();
                    } 
                    updateProgressBar(progress);
                    updateStepIndicator(index + 1);
                }
            });
            
            //Toggle day selection
            postDay.click(function(){
                if($(this).attr("class") === "btn btn-default postday") {
                    $(this).attr("class", "btn btn-primary postday");
                } else {
                    $(this).attr("class", "btn btn-default postday");
                }
            });
        });
        
        /*
            Hides and shows the divs for each step
        */
        function updateIndex(amount)
        {
            if(index >= 1 && index <= 4) {
                $('#step' + index).hide();
                index += amount;
                $('#step' + index).show();
            } else if(index > 4) {
                index--;
            }
        }
        
        /* 
            Updates the progress bar
        */
        function updateProgressBar(the_percentage)
        {
            //Update progress bar 
            postProgressBar.css("width", the_percentage + "%");
            
            //Update percentage text
            postProgressPercent.html(the_percentage + "%");    
        }
        
        /*
            Updates the step indicator
            @param:the_number integer
        */
        function updateStepIndicator(the_number)
        {
            $('.post-steps').html("Step " + the_number);
        }
    </script>
    <script type="text/javascript" src="javascripts/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="javascripts/jquery.iframe-transport.js"></script>
    <script type="text/javascript" src="javascripts/jquery.fileupload.js"></script>
    <script type="text/javascript" src="javascripts/jquery.fileupload-process.js"></script>
    <script type="text/javascript" src="javascripts/jquery.fileupload-image.js"></script>
</body>

</html>